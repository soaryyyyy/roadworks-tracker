{
	"info": {
		"_postman_id": "roadworks-tracker-api",
		"name": "Roadworks Tracker API",
		"description": "Collection complete des API du projet Roadworks Tracker.\n\nBase URL: http://localhost:8080\n\nAuthentification: Token Bearer via POST /api/auth/login\n\nProjet ITU - S5 - Groupe Mr Rojo",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"variable": [
		{
			"key": "base_url",
			"value": "http://localhost:8080",
			"type": "string"
		},
		{
			"key": "token",
			"value": "",
			"type": "string"
		}
	],
	"item": [
		{
			"name": "Auth",
			"description": "Authentification et gestion des utilisateurs",
			"item": [
				{
					"name": "Login",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 200) {",
									"    var jsonData = pm.response.json();",
									"    if (jsonData.token) {",
									"        pm.collectionVariables.set('token', jsonData.token);",
									"        console.log('Token sauvegarde automatiquement');",
									"    }",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{ "key": "Content-Type", "value": "application/json" }
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"username\": \"admin\",\n    \"password\": \"admin123\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/auth/login",
							"host": ["{{base_url}}"],
							"path": ["api", "auth", "login"]
						},
						"description": "Connexion utilisateur. Le token est automatiquement sauvegarde dans la variable token.\n\nCompte admin par defaut: admin / admin123"
					}
				},
				{
					"name": "Register",
					"request": {
						"method": "POST",
						"header": [
							{ "key": "Content-Type", "value": "application/json" }
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"username\": \"newuser\",\n    \"password\": \"password123\",\n    \"role\": \"utilisateur\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/auth/register",
							"host": ["{{base_url}}"],
							"path": ["api", "auth", "register"]
						},
						"description": "Inscription d'un nouvel utilisateur"
					}
				},
				{
					"name": "Logout",
					"request": {
						"method": "POST",
						"header": [
							{ "key": "Authorization", "value": "Bearer {{token}}" }
						],
						"url": {
							"raw": "{{base_url}}/api/auth/logout",
							"host": ["{{base_url}}"],
							"path": ["api", "auth", "logout"]
						},
						"description": "Deconnexion - invalide le token de session"
					}
				},
				{
					"name": "Validate Token",
					"request": {
						"method": "GET",
						"header": [
							{ "key": "Authorization", "value": "Bearer {{token}}" }
						],
						"url": {
							"raw": "{{base_url}}/api/auth/validate",
							"host": ["{{base_url}}"],
							"path": ["api", "auth", "validate"]
						},
						"description": "Verifie si le token de session est valide et non expire"
					}
				},
				{
					"name": "Get Roles",
					"request": {
						"method": "GET",
						"url": {
							"raw": "{{base_url}}/api/auth/roles",
							"host": ["{{base_url}}"],
							"path": ["api", "auth", "roles"]
						},
						"description": "Liste tous les roles disponibles"
					}
				},
				{
					"name": "Get Users (local)",
					"request": {
						"method": "GET",
						"header": [
							{ "key": "Authorization", "value": "Bearer {{token}}" }
						],
						"url": {
							"raw": "{{base_url}}/api/auth/users",
							"host": ["{{base_url}}"],
							"path": ["api", "auth", "users"]
						},
						"description": "Liste tous les utilisateurs de la base locale (PostgreSQL)"
					}
				},
				{
					"name": "Get Firebase Users",
					"request": {
						"method": "GET",
						"header": [
							{ "key": "Authorization", "value": "Bearer {{token}}" }
						],
						"url": {
							"raw": "{{base_url}}/api/auth/firebase-users",
							"host": ["{{base_url}}"],
							"path": ["api", "auth", "firebase-users"]
						},
						"description": "Liste les utilisateurs Firebase (application mobile)"
					}
				},
				{
					"name": "Import Firebase Users",
					"request": {
						"method": "POST",
						"header": [
							{ "key": "Authorization", "value": "Bearer {{token}}" }
						],
						"url": {
							"raw": "{{base_url}}/api/auth/import-firebase",
							"host": ["{{base_url}}"],
							"path": ["api", "auth", "import-firebase"]
						},
						"description": "Importe tous les utilisateurs Firebase vers la base locale"
					}
				},
				{
					"name": "Sync User Status to Firebase",
					"request": {
						"method": "POST",
						"header": [
							{ "key": "Authorization", "value": "Bearer {{token}}" }
						],
						"url": {
							"raw": "{{base_url}}/api/auth/sync-status-to-firebase",
							"host": ["{{base_url}}"],
							"path": ["api", "auth", "sync-status-to-firebase"]
						},
						"description": "Synchronise les statuts bloque/debloque vers Firebase/Firestore"
					}
				},
				{
					"name": "Update User",
					"request": {
						"method": "PUT",
						"header": [
							{ "key": "Content-Type", "value": "application/json" },
							{ "key": "Authorization", "value": "Bearer {{token}}" }
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"role\": \"manager\",\n    \"password\": \"\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/auth/users/:userId",
							"host": ["{{base_url}}"],
							"path": ["api", "auth", "users", ":userId"],
							"variable": [
								{ "key": "userId", "value": "1", "description": "ID utilisateur (local ou UID Firebase)" }
							]
						},
						"description": "Met a jour un utilisateur (role, mot de passe). Laisser password vide pour ne pas modifier."
					}
				},
				{
					"name": "Unlock Local User",
					"request": {
						"method": "POST",
						"header": [
							{ "key": "Authorization", "value": "Bearer {{token}}" }
						],
						"url": {
							"raw": "{{base_url}}/api/auth/users/:userId/unlock",
							"host": ["{{base_url}}"],
							"path": ["api", "auth", "users", ":userId", "unlock"],
							"variable": [
								{ "key": "userId", "value": "1", "description": "ID utilisateur local" }
							]
						},
						"description": "Debloque un compte utilisateur local bloque"
					}
				},
				{
					"name": "Unlock Firebase User",
					"request": {
						"method": "POST",
						"header": [
							{ "key": "Authorization", "value": "Bearer {{token}}" }
						],
						"url": {
							"raw": "{{base_url}}/api/auth/firebase-users/:firebaseUid/unlock",
							"host": ["{{base_url}}"],
							"path": ["api", "auth", "firebase-users", ":firebaseUid", "unlock"],
							"variable": [
								{ "key": "firebaseUid", "value": "", "description": "UID Firebase de l'utilisateur" }
							]
						},
						"description": "Debloque un utilisateur Firebase dans Firestore"
					}
				},
				{
					"name": "Delete User (placeholder)",
					"request": {
						"method": "DELETE",
						"header": [
							{ "key": "Authorization", "value": "Bearer {{token}}" }
						],
						"url": {
							"raw": "{{base_url}}/api/auth/users/:userId",
							"host": ["{{base_url}}"],
							"path": ["api", "auth", "users", ":userId"],
							"variable": [
								{ "key": "userId", "value": "1", "description": "ID utilisateur" }
							]
						},
						"description": "Supprime un utilisateur (non implemente, retourne 501)"
					}
				}
			]
		},
		{
			"name": "Signalements",
			"description": "CRUD et gestion des signalements d'incidents routiers",
			"item": [
				{
					"name": "Get All Signalements",
					"request": {
						"method": "GET",
						"header": [
							{ "key": "Authorization", "value": "Bearer {{token}}" },
							{ "key": "X-Username", "value": "admin" }
						],
						"url": {
							"raw": "{{base_url}}/api/signalements",
							"host": ["{{base_url}}"],
							"path": ["api", "signalements"]
						},
						"description": "Liste tous les signalements avec details (type probleme, statut, entreprise, couts)"
					}
				},
				{
					"name": "Get Signalement by ID",
					"request": {
						"method": "GET",
						"header": [
							{ "key": "Authorization", "value": "Bearer {{token}}" },
							{ "key": "X-Username", "value": "admin" }
						],
						"url": {
							"raw": "{{base_url}}/api/signalements/:id",
							"host": ["{{base_url}}"],
							"path": ["api", "signalements", ":id"],
							"variable": [
								{ "key": "id", "value": "1", "description": "ID du signalement" }
							]
						},
						"description": "Recupere un signalement par ID"
					}
				},
				{
					"name": "Get Signalements by Status",
					"request": {
						"method": "GET",
						"header": [
							{ "key": "Authorization", "value": "Bearer {{token}}" }
						],
						"url": {
							"raw": "{{base_url}}/api/signalements/status/:status",
							"host": ["{{base_url}}"],
							"path": ["api", "signalements", "status", ":status"],
							"variable": [
								{ "key": "status", "value": "nouveau", "description": "Statut: nouveau, en_cours, termine, annule" }
							]
						},
						"description": "Filtre les signalements par statut. Valeurs: nouveau, en_cours, termine, annule"
					}
				},
				{
					"name": "Get Signalement Photos",
					"request": {
						"method": "GET",
						"header": [
							{ "key": "Authorization", "value": "Bearer {{token}}" }
						],
						"url": {
							"raw": "{{base_url}}/api/signalements/:id/photos",
							"host": ["{{base_url}}"],
							"path": ["api", "signalements", ":id", "photos"],
							"variable": [
								{ "key": "id", "value": "1", "description": "ID du signalement" }
							]
						},
						"description": "Recupere les photos associees a un signalement"
					}
				},
				{
					"name": "Update Status",
					"request": {
						"method": "PUT",
						"header": [
							{ "key": "Content-Type", "value": "application/json" },
							{ "key": "Authorization", "value": "Bearer {{token}}" },
							{ "key": "X-Username", "value": "admin" }
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"status\": \"en_cours\",\n    \"realEndDate\": null\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/signalements/:id/status",
							"host": ["{{base_url}}"],
							"path": ["api", "signalements", ":id", "status"],
							"variable": [
								{ "key": "id", "value": "1", "description": "ID du signalement" }
							]
						},
						"description": "Met a jour le statut d'un signalement.\n\nStatuts: nouveau, en_cours, termine, annule\n\nREGLE: Le statut ne peut pas regresser (ex: en_cours ne peut pas redevenir nouveau).\nSi le statut est 'termine', le champ realEndDate (YYYY-MM-DD) est obligatoire."
					}
				},
				{
					"name": "Add Work (Reparation)",
					"request": {
						"method": "POST",
						"header": [
							{ "key": "Content-Type", "value": "application/json" },
							{ "key": "Authorization", "value": "Bearer {{token}}" },
							{ "key": "X-Username", "value": "admin" }
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"surface\": 25.50,\n    \"companyId\": 1,\n    \"startDate\": \"2026-02-10\",\n    \"endDate\": \"2026-03-10\",\n    \"price\": 150000.00,\n    \"reparationTypeId\": 3\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/signalements/:id/work",
							"host": ["{{base_url}}"],
							"path": ["api", "signalements", ":id", "work"],
							"variable": [
								{ "key": "id", "value": "1", "description": "ID du signalement" }
							]
						},
						"description": "Ajoute une reparation a un signalement.\n\nChamps:\n- surface (number, obligatoire): Surface en m2\n- companyId (Long, obligatoire): ID de l'entreprise\n- startDate (string, optionnel): Date debut YYYY-MM-DD\n- endDate (string, optionnel): Date fin estimee YYYY-MM-DD\n- price (number, obligatoire): Budget en Ariary\n- reparationTypeId (Long, optionnel): Niveau de reparation (1-10)\n\nLe statut passe automatiquement a en_cours."
					}
				},
				{
					"name": "Sync from Firebase",
					"request": {
						"method": "POST",
						"header": [
							{ "key": "Authorization", "value": "Bearer {{token}}" },
							{ "key": "X-Username", "value": "admin" }
						],
						"url": {
							"raw": "{{base_url}}/api/signalements/sync/firebase",
							"host": ["{{base_url}}"],
							"path": ["api", "signalements", "sync", "firebase"]
						},
						"description": "Importe les signalements depuis Firebase vers la BD locale. Les doublons sont detectes par firebase_id."
					}
				},
				{
					"name": "Export to Firebase",
					"request": {
						"method": "POST",
						"header": [
							{ "key": "Authorization", "value": "Bearer {{token}}" },
							{ "key": "X-Username", "value": "admin" }
						],
						"url": {
							"raw": "{{base_url}}/api/signalements/sync/to-firebase",
							"host": ["{{base_url}}"],
							"path": ["api", "signalements", "sync", "to-firebase"]
						},
						"description": "Exporte les signalements locaux (sans firebase_id) vers Firebase"
					}
				},
				{
					"name": "Sync All Status to Firebase",
					"request": {
						"method": "POST",
						"header": [
							{ "key": "Authorization", "value": "Bearer {{token}}" },
							{ "key": "X-Username", "value": "admin" }
						],
						"url": {
							"raw": "{{base_url}}/api/signalements/sync/status-to-firebase",
							"host": ["{{base_url}}"],
							"path": ["api", "signalements", "sync", "status-to-firebase"]
						},
						"description": "Synchronise tous les statuts vers Firebase pour l'application mobile"
					}
				},
				{
					"name": "Sync Single to Firebase",
					"request": {
						"method": "POST",
						"header": [
							{ "key": "Authorization", "value": "Bearer {{token}}" },
							{ "key": "X-Username", "value": "admin" }
						],
						"url": {
							"raw": "{{base_url}}/api/signalements/:id/sync/firebase",
							"host": ["{{base_url}}"],
							"path": ["api", "signalements", ":id", "sync", "firebase"],
							"variable": [
								{ "key": "id", "value": "1", "description": "ID du signalement" }
							]
						},
						"description": "Synchronise un signalement specifique vers Firebase"
					}
				},
				{
					"name": "Get Unsynced from Firebase",
					"request": {
						"method": "GET",
						"header": [
							{ "key": "Authorization", "value": "Bearer {{token}}" },
							{ "key": "X-Username", "value": "admin" }
						],
						"url": {
							"raw": "{{base_url}}/api/signalements/firebase/unsynced",
							"host": ["{{base_url}}"],
							"path": ["api", "signalements", "firebase", "unsynced"]
						},
						"description": "Recupere les signalements Firebase non encore importes en local (reserve aux managers)"
					}
				}
			]
		},
		{
			"name": "Companies",
			"description": "Gestion des entreprises de reparation",
			"item": [
				{
					"name": "Get All Companies",
					"request": {
						"method": "GET",
						"url": {
							"raw": "{{base_url}}/api/companies",
							"host": ["{{base_url}}"],
							"path": ["api", "companies"]
						},
						"description": "Liste toutes les entreprises"
					}
				},
				{
					"name": "Get Company by ID",
					"request": {
						"method": "GET",
						"url": {
							"raw": "{{base_url}}/api/companies/:id",
							"host": ["{{base_url}}"],
							"path": ["api", "companies", ":id"],
							"variable": [
								{ "key": "id", "value": "1", "description": "ID de l'entreprise" }
							]
						},
						"description": "Recupere une entreprise par son ID"
					}
				},
				{
					"name": "Create Company",
					"request": {
						"method": "POST",
						"header": [
							{ "key": "Content-Type", "value": "application/json" },
							{ "key": "Authorization", "value": "Bearer {{token}}" }
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"name\": \"BTP Madagascar\",\n    \"siret\": \"12345678901234\",\n    \"address\": \"Lot IB 123, Antananarivo\",\n    \"phone\": \"+261 34 00 000 00\",\n    \"email\": \"contact@btp-mada.mg\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/companies",
							"host": ["{{base_url}}"],
							"path": ["api", "companies"]
						},
						"description": "Cree une nouvelle entreprise. Le SIRET doit etre unique."
					}
				},
				{
					"name": "Update Company",
					"request": {
						"method": "PUT",
						"header": [
							{ "key": "Content-Type", "value": "application/json" },
							{ "key": "Authorization", "value": "Bearer {{token}}" }
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"name\": \"BTP Madagascar Updated\",\n    \"email\": \"info@btp-mada.mg\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/companies/:id",
							"host": ["{{base_url}}"],
							"path": ["api", "companies", ":id"],
							"variable": [
								{ "key": "id", "value": "1", "description": "ID de l'entreprise" }
							]
						},
						"description": "Met a jour une entreprise. Seuls les champs fournis sont modifies."
					}
				},
				{
					"name": "Delete Company",
					"request": {
						"method": "DELETE",
						"header": [
							{ "key": "Authorization", "value": "Bearer {{token}}" }
						],
						"url": {
							"raw": "{{base_url}}/api/companies/:id",
							"host": ["{{base_url}}"],
							"path": ["api", "companies", ":id"],
							"variable": [
								{ "key": "id", "value": "1", "description": "ID de l'entreprise" }
							]
						},
						"description": "Supprime une entreprise (irreversible)"
					}
				}
			]
		},
		{
			"name": "Reparation Types",
			"description": "Niveaux de reparation disponibles (1 a 10)",
			"item": [
				{
					"name": "Get All Reparation Types",
					"request": {
						"method": "GET",
						"url": {
							"raw": "{{base_url}}/api/reparation-types",
							"host": ["{{base_url}}"],
							"path": ["api", "reparation-types"]
						},
						"description": "Liste tous les niveaux de reparation, tries par niveau croissant"
					}
				}
			]
		},
		{
			"name": "Forfaits M2",
			"description": "CRUD du tarif forfaitaire au m2 (table default_price)",
			"item": [
				{
					"name": "Get All Forfaits",
					"request": {
						"method": "GET",
						"url": {
							"raw": "{{base_url}}/api/m2-forfaits",
							"host": ["{{base_url}}"],
							"path": ["api", "m2-forfaits"]
						},
						"description": "Liste tous les forfaits de prix au m2"
					}
				},
				{
					"name": "Get Current Forfait",
					"request": {
						"method": "GET",
						"url": {
							"raw": "{{base_url}}/api/m2-forfaits/current",
							"host": ["{{base_url}}"],
							"path": ["api", "m2-forfaits", "current"]
						},
						"description": "Recupere le prix forfaitaire courant (le dernier enregistre)"
					}
				},
				{
					"name": "Get Forfait by ID",
					"request": {
						"method": "GET",
						"url": {
							"raw": "{{base_url}}/api/m2-forfaits/:id",
							"host": ["{{base_url}}"],
							"path": ["api", "m2-forfaits", ":id"],
							"variable": [
								{ "key": "id", "value": "1", "description": "ID du forfait" }
							]
						},
						"description": "Recupere un forfait m2 par son ID"
					}
				},
				{
					"name": "Create Forfait",
					"request": {
						"method": "POST",
						"header": [
							{ "key": "Content-Type", "value": "application/json" },
							{ "key": "Authorization", "value": "Bearer {{token}}" }
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"prixM2\": 7500.00\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/m2-forfaits",
							"host": ["{{base_url}}"],
							"path": ["api", "m2-forfaits"]
						},
						"description": "Cree un nouveau forfait m2. Accepte prixM2 ou price (valeur > 0)."
					}
				},
				{
					"name": "Update Forfait",
					"request": {
						"method": "PUT",
						"header": [
							{ "key": "Content-Type", "value": "application/json" },
							{ "key": "Authorization", "value": "Bearer {{token}}" }
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"prixM2\": 8000.00\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/m2-forfaits/:id",
							"host": ["{{base_url}}"],
							"path": ["api", "m2-forfaits", ":id"],
							"variable": [
								{ "key": "id", "value": "1", "description": "ID du forfait" }
							]
						},
						"description": "Met a jour un forfait m2 existant"
					}
				},
				{
					"name": "Delete Forfait",
					"request": {
						"method": "DELETE",
						"header": [
							{ "key": "Authorization", "value": "Bearer {{token}}" }
						],
						"url": {
							"raw": "{{base_url}}/api/m2-forfaits/:id",
							"host": ["{{base_url}}"],
							"path": ["api", "m2-forfaits", ":id"],
							"variable": [
								{ "key": "id", "value": "1", "description": "ID du forfait" }
							]
						},
						"description": "Supprime un forfait m2"
					}
				}
			]
		},
		{
			"name": "Advancement Rates",
			"description": "Taux d'avancement par statut",
			"item": [
				{
					"name": "Get All Rates",
					"request": {
						"method": "GET",
						"header": [
							{ "key": "Authorization", "value": "Bearer {{token}}" }
						],
						"url": {
							"raw": "{{base_url}}/api/advancement-rates",
							"host": ["{{base_url}}"],
							"path": ["api", "advancement-rates"]
						},
						"description": "Liste tous les taux d'avancement par statut"
					}
				},
				{
					"name": "Update Rate",
					"request": {
						"method": "PUT",
						"header": [
							{ "key": "Authorization", "value": "Bearer {{token}}" }
						],
						"url": {
							"raw": "{{base_url}}/api/advancement-rates/:statusKey?percentage=50",
							"host": ["{{base_url}}"],
							"path": ["api", "advancement-rates", ":statusKey"],
							"query": [
								{ "key": "percentage", "value": "50", "description": "Pourcentage (0-100)" }
							],
							"variable": [
								{ "key": "statusKey", "value": "en_cours", "description": "Cle du statut (nouveau, en_cours, termine)" }
							]
						},
						"description": "Cree ou met a jour le taux d'avancement pour un statut donne"
					}
				}
			]
		},
		{
			"name": "Analytics",
			"description": "Statistiques et timeline des travaux",
			"item": [
				{
					"name": "Get Work Stats",
					"request": {
						"method": "GET",
						"header": [
							{ "key": "Authorization", "value": "Bearer {{token}}" }
						],
						"url": {
							"raw": "{{base_url}}/api/analytics/work-stats?companyId=&startDate=&endDate=&typeProblem=",
							"host": ["{{base_url}}"],
							"path": ["api", "analytics", "work-stats"],
							"query": [
								{ "key": "companyId", "value": "", "description": "(Optionnel) ID entreprise" },
								{ "key": "startDate", "value": "", "description": "(Optionnel) Date debut YYYY-MM-DD" },
								{ "key": "endDate", "value": "", "description": "(Optionnel) Date fin YYYY-MM-DD" },
								{ "key": "typeProblem", "value": "", "description": "(Optionnel) Type de probleme" }
							]
						},
						"description": "Calcule les statistiques agregees des travaux avec filtres optionnels"
					}
				},
				{
					"name": "Get Work Timelines",
					"request": {
						"method": "GET",
						"header": [
							{ "key": "Authorization", "value": "Bearer {{token}}" }
						],
						"url": {
							"raw": "{{base_url}}/api/analytics/work-timelines?companyId=&startDate=&endDate=&typeProblem=",
							"host": ["{{base_url}}"],
							"path": ["api", "analytics", "work-timelines"],
							"query": [
								{ "key": "companyId", "value": "", "description": "(Optionnel) ID entreprise" },
								{ "key": "startDate", "value": "", "description": "(Optionnel) Date debut YYYY-MM-DD" },
								{ "key": "endDate", "value": "", "description": "(Optionnel) Date fin YYYY-MM-DD" },
								{ "key": "typeProblem", "value": "", "description": "(Optionnel) Type de probleme" }
							]
						},
						"description": "Liste les timelines detaillees des travaux avec filtres optionnels"
					}
				}
			]
		}
	]
}
